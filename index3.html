<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ™®é€šè©± j q x æœ—è®€æŒ‘æˆ°</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; text-align: center; background: #f3e5f5; padding: 20px; color: #333; }
    .container { max-width: 700px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); position: relative; min-height: 520px; }
    h1 { color: #7b1fa2; }
    .word-box { font-size: 80px; color: #4a148c; margin: 20px 0; padding: 20px; border: 4px dashed #e1bee7; border-radius: 15px; }
    .info { font-size: 20px; margin: 10px 0; color: #666; }
    button { margin: 10px; padding: 15px 35px; font-size: 20px; cursor: pointer; border: none; border-radius: 50px; transition: 0.3s; font-weight: bold; }
    .play-btn { background: #9c27b0; color: white; }
    .record-btn { background: #e91e63; color: white; }
    .record-btn.active { background: #9e9e9e; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0.6; } }
    
    /* å°èˆªæŒ‰éµæ¨£å¼ */
    .nav-btn { position: absolute; bottom: 20px; background: #607d8b; color: white; padding: 10px 20px; font-size: 16px; border-radius: 10px; cursor: pointer; border: none; }
    .nav-btn:hover { background: #455a64; }
    .skip-btn { right: 20px; }
    .prev-btn { left: 20px; }
    .nav-btn:disabled { background: #cfd8dc; cursor: not-allowed; }

    #result-msg { margin-top: 20px; font-size: 24px; min-height: 40px; font-weight: bold; }
    .stats { display: flex; justify-content: space-around; margin-top: 30px; font-size: 24px; background: #f5f5f5; padding: 15px; border-radius: 10px; }
    .final-screen { display: none; }
    .score-high { color: #2e7d32; font-size: 40px; }
    .score-mid { color: #ef6c00; font-size: 40px; }
    .score-low { color: #c62828; font-size: 40px; }
  </style>
</head>
<body>

<div class="container" id="game-container">
  <h1>ğŸ™ï¸ æ™®é€šè©± j q x æœ—è®€æŒ‘æˆ°</h1>
  <p class="info">è«‹æº–ç¢ºç™¼å‡ºèˆŒé¢å‰éŸ³ï¼Œæ¯å€‹è©èªæœ‰ä¸‰æ¬¡æ©Ÿæœƒï¼</p>
  
  <div class="stats">
    <div>ç´¯è¨ˆå¾—åˆ†ï¼š<span id="current-score">0</span></div>
    <div>å‰©é¤˜æ©Ÿæœƒï¼š<span id="chances">3</span></div>
  </div>

  <div class="word-box" id="targetWord">è¼‰å…¥ä¸­...</div>
  
  <button class="play-btn" onclick="playSample()">æ’­æ”¾ç¤ºç¯„éŸ³ ğŸ”Š</button>
  <button class="record-btn" id="recordBtn" onclick="startRecognition()">é–‹å§‹æœ—è®€ ğŸ¤</button>
  
  <div id="result-msg"></div>
  <p id="progress" style="margin-top:20px; color:#888;">é€²åº¦ï¼š1 / 20</p>

  <button class="nav-btn prev-btn" id="prevBtn" onclick="prevWord()">â¬… ä¸Šä¸€é¡Œ</button>
  <button class="nav-btn skip-btn" onclick="skipWord()">ä¸‹ä¸€é¡Œ â”</button>
</div>

<div class="container final-screen" id="final-screen">
  <h1>æ¸¬é©—çµæœ</h1>
  <div id="total-score-display" style="font-size: 60px; font-weight: bold;"></div>
  <div id="final-msg" style="margin: 30px 0;"></div>
  <button class="play-btn" onclick="location.reload()">é‡æ–°æŒ‘æˆ° ğŸ”„</button>
</div>

<script>
  const wordList = [
    "ç©æ¥µ", "æƒ…æ³", "ä¼‘æ¯", "æ©Ÿå™¨", "æƒ…ç·’", 
    "æ–°é®®", "æŠ€å·§", "ç¢ºå¯¦", "è©³ç´°", "èšé›†", 
    "å‰é€²", "å¿ƒæƒ³", "å¢ƒç•Œ", "æ¼†é»‘", "ç›¸ä¿¡", 
    "è§£æ±º", "è«‹æ±‚", "è™›å¿ƒ", "å³ä½¿", "ç§‹å¤©"
  ];

  let currentIndex = 0;
  let chancesArray = new Array(wordList.length).fill(3); // ç´€éŒ„æ¯ä¸€é¡Œçš„å‰©é¤˜æ©Ÿæœƒ
  let scoresArray = new Array(wordList.length).fill(0);  // ç´€éŒ„æ¯ä¸€é¡Œçš„å¾—åˆ†
  let isLevelPassedArray = new Array(wordList.length).fill(false); // ç´€éŒ„æ¯ä¸€é¡Œæ˜¯å¦å·²é€šé

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = 'zh-CN'; 

  function calculateTotalScore() {
    return scoresArray.reduce((a, b) => a + b, 0);
  }

  function updateDisplay() {
    if (currentIndex < wordList.length) {
      document.getElementById('targetWord').innerText = wordList[currentIndex];
      document.getElementById('progress').innerText = `é€²åº¦ï¼š${currentIndex + 1} / ${wordList.length}`;
      document.getElementById('chances').innerText = chancesArray[currentIndex];
      document.getElementById('current-score').innerText = calculateTotalScore();
      
      // æ§åˆ¶ä¸Šä¸€é¡ŒæŒ‰éˆ•æ˜¯å¦å¯ç”¨
      document.getElementById('prevBtn').disabled = (currentIndex === 0);
      
      // å¦‚æœé€™é¡Œå·²ç¶“éé—œï¼Œé¡¯ç¤ºæç¤º
      if (isLevelPassedArray[currentIndex]) {
        document.getElementById('result-msg').innerHTML = "<span style='color:green;'>é€™é¡Œä½ å·²ç¶“è®€å°å›‰ï¼âœ…</span>";
      } else {
        document.getElementById('result-msg').innerText = "";
      }
    } else {
      showFinalResult();
    }
  }

  function playSample() {
    const msg = new SpeechSynthesisUtterance(wordList[currentIndex]);
    msg.lang = 'zh-CN';
    window.speechSynthesis.speak(msg);
  }

  function startRecognition() {
    if (isLevelPassedArray[currentIndex] || chancesArray[currentIndex] <= 0) return;
    
    const btn = document.getElementById('recordBtn');
    if (window.AudioContext) { new AudioContext().resume(); } 
    
    recognition.start();
    btn.classList.add('active');
    btn.innerText = "æ­£åœ¨éŒ„éŸ³...";

    recognition.onresult = (event) => {
      const studentText = event.results[0][0].transcript;
      btn.classList.remove('active');
      btn.innerText = "é–‹å§‹æœ—è®€ ğŸ¤";
      checkResult(studentText);
    };

    recognition.onerror = () => {
      btn.classList.remove('active');
      btn.innerText = "é–‹å§‹æœ—è®€ ğŸ¤";
      document.getElementById('result-msg').innerText = "æ²’è½æ¸…æ¥šï¼Œè«‹å†è©¦ä¸€æ¬¡";
    };
  }

  function checkResult(studentText) {
    const target = wordList[currentIndex];
    const resultMsg = document.getElementById('result-msg');

    if (studentText.includes(target)) {
      scoresArray[currentIndex] = 5;
      isLevelPassedArray[currentIndex] = true;
      resultMsg.innerHTML = "<span style='color:green;'>âœ… å¤ªæ£’äº†ï¼ç™¼éŸ³æ­£ç¢º (+5åˆ†)</span>";
      setTimeout(nextWord, 1200);
    } else {
      chancesArray[currentIndex]--;
      if (chancesArray[currentIndex] > 0) {
        resultMsg.innerHTML = `<span style='color:orange;'>âŒ è½èµ·ä¾†åƒã€Œ${studentText}ã€ï¼Œå‰©é¤˜ ${chancesArray[currentIndex]} æ¬¡æ©Ÿæœƒ</span>`;
        document.getElementById('chances').innerText = chancesArray[currentIndex];
      } else {
        resultMsg.innerHTML = `<span style='color:red;'>æ©Ÿæœƒç”¨å®Œï¼Œå»ºè­°æŸ¥çœ‹ä¸‹ä¸€é¡Œã€‚</span>`;
      }
    }
    document.getElementById('current-score').innerText = calculateTotalScore();
  }

  function prevWord() {
    if (currentIndex > 0) {
      currentIndex--;
      updateDisplay();
    }
  }

  function skipWord() {
    nextWord();
  }

  function nextWord() {
    currentIndex++;
    updateDisplay();
  }

  function showFinalResult() {
    document.getElementById('game-container').style.display = 'none';
    const screen = document.getElementById('final-screen');
    const scoreDisplay = document.getElementById('total-score-display');
    const msgDisplay = document.getElementById('final-msg');
    
    screen.style.display = 'block';
    let totalScore = calculateTotalScore();
    scoreDisplay.innerText = totalScore + " åˆ†";

    if (totalScore < 60) {
      msgDisplay.innerHTML = "<div class='score-low'>è«‹ç¹¼çºŒåŠ æ²¹ï¼</div>";
    } else if (totalScore <= 80) {
      msgDisplay.innerHTML = "<div class='score-mid'>è¡¨ç¾ä¸éŒ¯ï¼Œå†æ¥å†å²ï¼</div>";
    } else {
      msgDisplay.innerHTML = "<div class='score-high'>æ­å–œä½ ï¼Œéå¸¸æ£’ï¼</div>";
    }
  }

  updateDisplay();
</script>

</body>
</html>
