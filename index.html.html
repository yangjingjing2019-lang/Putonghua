<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™®é€šè©±è²æ¯äº”æ­¥é€šé—œæŒ‘æˆ°</title>
    <style>
        :root { --accent: #ff7675; --main: #6c5ce7; --bg: #f0f2f5; --success: #00b894; }
        body { font-family: 'PingFang HK', 'Microsoft JhengHei', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #game-card { background: white; width: 100%; max-width: 500px; border-radius: 24px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        .progress-bar::before { content: ''; position: absolute; top: 15px; left: 0; right: 0; height: 2px; background: #eee; z-index: 1; }
        .step { width: 30px; height: 30px; border-radius: 50%; background: #eee; z-index: 2; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: #999; }
        .step.active { background: var(--main); color: white; box-shadow: 0 0 10px rgba(108, 92, 231, 0.5); }
        .step.done { background: var(--success); color: white; }

        .quiz-zone { text-align: center; }
        .info-bar { display: flex; justify-content: space-between; font-size: 14px; color: #636e72; margin-bottom: 10px; }
        .target-word { font-size: 100px; margin: 15px 0; color: #2d3436; font-weight: bold; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        
        button { padding: 18px; border: 2px solid #f1f2f6; border-radius: 16px; background: #f8f9fa; cursor: pointer; font-size: 24px; font-weight: bold; color: var(--main); transition: 0.2s; }
        button:hover:not(:disabled) { border-color: var(--main); background: #f1f0ff; }
        button.correct { background: var(--success) !important; color: white; border-color: var(--success); }
        button.wrong { background: var(--accent) !important; color: white; border-color: var(--accent); }
        .nav-btn { background: var(--main); color: white; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

<div id="game-card">
    <div class="progress-bar" id="progress-bar">
        <div class="step" id="s1">1</div>
        <div class="step" id="s2">2</div>
        <div class="step" id="s3">3</div>
        <div class="step" id="s4">4</div>
        <div class="step" id="s5">5</div>
    </div>

    <div id="game-content" class="quiz-zone">
        <div class="info-bar">
            <span id="question-num">ç¬¬ 1 / 20 é¡Œ</span>
            <span>ç©åˆ†: <span id="score-display">0</span></span>
        </div>
        <div id="stage-name" style="color: var(--main); font-weight: bold; margin-bottom: 10px;"></div>
        <div class="target-word" id="display-word">...</div>
        <div class="options" id="options-grid"></div>
        <div id="feedback" style="margin-top: 15px; height: 20px; font-weight: bold;"></div>
    </div>
</div>

<script>
    const allStages = {
        1: { name: "ç¬¬ä¸€é—œï¼šå¹³ç¿¹èˆŒéŸ³ (z/c/s vs zh/ch/sh)", data: [
            {w:"ç«™", c:"zh", o:["z","zh"]}, {w:"åœ¨", c:"z", o:["z","zh"]}, {w:"æ—©", c:"z", o:["z","zh"]}, {w:"ä¸­", c:"zh", o:["z","zh"]},
            {w:"è‰", c:"c", o:["c","ch"]}, {w:"å”±", c:"ch", o:["c","ch"]}, {w:"ä¸‰", c:"s", o:["s","sh"]}, {w:"å±±", c:"sh", o:["s","sh"]},
            {w:"æ˜¨", c:"z", o:["z","zh"]}, {w:"é€™", c:"zh", o:["z","zh"]}, {w:"æ¬¡", c:"c", o:["c","ch"]}, {w:"è»Š", c:"ch", o:["c","ch"]},
            {w:"æ­»", c:"s", o:["s","sh"]}, {w:"æ˜¯", c:"sh", o:["s","sh"]}, {w:"èµ°", c:"z", o:["z","zh"]}, {w:"ç›´", c:"zh", o:["z","zh"]},
            {w:"æ‰", c:"c", o:["c","ch"]}, {w:"å‡º", c:"ch", o:["c","ch"]}, {w:"ç®—", c:"s", o:["s","sh"]}, {w:"ä¸Š", c:"sh", o:["s","sh"]}
        ]},
        2: { name: "ç¬¬äºŒé—œï¼šé¼»éŸ³èˆ‡é‚ŠéŸ³ (n vs l)", data: [
            {w:"å—", c:"n", o:["n","l"]}, {w:"è˜­", c:"l", o:["n","l"]}, {w:"ç‰›", c:"n", o:["n","l"]}, {w:"æµ", c:"l", o:["n","l"]},
            {w:"å¹´", c:"n", o:["n","l"]}, {w:"é€£", c:"l", o:["n","l"]}, {w:"æ€’", c:"n", o:["n","l"]}, {w:"è·¯", c:"l", o:["n","l"]},
            {w:"å…§", c:"n", o:["n","l"]}, {w:"ç´¯", c:"l", o:["n","l"]}, {w:"ç”·", c:"n", o:["n","l"]}, {w:"è—", c:"l", o:["n","l"]},
            {w:"å¥¶", c:"n", o:["n","l"]}, {w:"ä¾†", c:"l", o:["n","l"]}, {w:"èƒ½", c:"n", o:["n","l"]}, {w:"å†·", c:"l", o:["n","l"]},
            {w:"æ³¥", c:"n", o:["n","l"]}, {w:"é›¢", c:"l", o:["n","l"]}, {w:"å¿µ", c:"n", o:["n","l"]}, {w:"ç·´", c:"l", o:["n","l"]}
        ]},
        3: { name: "ç¬¬ä¸‰é—œï¼šå”‡é½’/èˆŒæ ¹/èˆŒå°–éŸ³ (b/p/f/d/t/g/k/h)", data: [
            {w:"å…«", c:"b", o:["b","p"]}, {w:"æ€•", c:"p", o:["b","p"]}, {w:"ç™¼", c:"f", o:["f","h"]}, {w:"èŠ±", c:"h", o:["f","h"]},
            {w:"å¤§", c:"d", o:["d","t"]}, {w:"ä»–", c:"t", o:["d","t"]}, {w:"å€‹", c:"g", o:["g","k"]}, {w:"å¯", c:"k", o:["g","k"]},
            {w:"æ¯”", c:"b", o:["b","p"]}, {w:"è·‘", c:"p", o:["b","p"]}, {w:"é¢¨", c:"f", o:["f","h"]}, {w:"ç´…", c:"h", o:["f","h"]},
            {w:"åœ°", c:"d", o:["d","t"]}, {w:"æ", c:"t", o:["d","t"]}, {w:"å§‘", c:"g", o:["g","k"]}, {w:"å“­", c:"k", o:["g","k"]},
            {w:"åŒ…", c:"b", o:["b","p"]}, {w:"çš®", c:"p", o:["b","p"]}, {w:"é£›", c:"f", o:["f","h"]}, {w:"ç°", c:"h", o:["f","h"]}
        ]},
        4: { name: "ç¬¬å››é—œï¼šèˆŒé¢éŸ³èˆ‡ç²¾ç´°è¾¨æ (j/q/x/r)", data: [
            {w:"å®¶", c:"j", o:["j","q"]}, {w:"ä¸ƒ", c:"q", o:["j","q"]}, {w:"å°", c:"x", o:["s","x"]}, {w:"äºº", c:"r", o:["l","r"]},
            {w:"é›", c:"j", o:["j","q"]}, {w:"å»", c:"q", o:["j","q"]}, {w:"æ´—", c:"x", o:["s","x"]}, {w:"ç†±", c:"r", o:["l","r"]},
            {w:"é€²", c:"j", o:["j","q"]}, {w:"å‰", c:"q", o:["j","q"]}, {w:"æƒ³", c:"x", o:["s","x"]}, {w:"è‚‰", c:"r", o:["l","r"]},
            {w:"å°±", c:"j", o:["j","q"]}, {w:"è«‹", c:"q", o:["j","q"]}, {w:"æ ¡", c:"x", o:["s","x"]}, {w:"æ—¥", c:"r", o:["l","r"]},
            {w:"å«", c:"j", o:["j","q"]}, {w:"å…¨", c:"q", o:["j","q"]}, {w:"è¬", c:"x", o:["s","x"]}, {w:"å¦‚", c:"r", o:["l","r"]}
        ]},
        5: { name: "ç¬¬äº”é—œï¼šçµ‚æ¥µæ··åˆæŒ‘æˆ° (ç¶œåˆè¤‡ç¿’)", data: [
            {w:"æ›¸", c:"sh", o:["s","sh"]}, {w:"è¶³", c:"z", o:["z","zh"]}, {w:"å…­", c:"l", o:["n","l"]}, {w:"æ‚¨", c:"n", o:["n","l"]},
            {w:"æ©‹", c:"q", o:["j","q"]}, {w:"çœ‹", c:"k", o:["g","k"]}, {w:"è©±", c:"h", o:["f","h"]}, {w:"å¤š", c:"d", o:["d","t"]},
            {w:"é€™", c:"zh", o:["z","zh"]}, {w:"èœ", c:"c", o:["c","ch"]}, {w:"æ‹¿", c:"n", o:["n","l"]}, {w:"äº®", c:"l", o:["n","l"]},
            {w:"è®“", c:"r", o:["l","r"]}, {w:"æƒ…", c:"q", o:["j","q"]}, {w:"é¸", c:"x", o:["s","x"]}, {w:"æ‰¾", c:"zh", o:["z","zh"]},
            {w:"æ­¤", c:"c", o:["c","ch"]}, {w:"æ”¶", c:"sh", o:["s","sh"]}, {w:"å°", c:"d", o:["d","t"]}, {w:"æœ‹", c:"p", o:["b","p"]}
        ]}
    };

    let currentStage = parseInt(localStorage.getItem('mandarinStage')) || 1;
    let score = parseInt(localStorage.getItem('mandarinScore')) || 0;
    let quizIdx = 0;
    let canClick = true;

    function init() {
        if (currentStage > 5) {
            showFinalResult();
            return;
        }
        updateProgressBar();
        quizIdx = 0; // é‡ç½®ç•¶å‰é—œå¡çš„é¡Œç›®ç´¢å¼•
        loadQuestion();
    }

    function updateProgressBar() {
        for(let i=1; i<=5; i++) {
            const el = document.getElementById('s'+i);
            el.className = 'step';
            if (i < currentStage) el.classList.add('done');
            if (i === currentStage) el.classList.add('active');
        }
    }

    function loadQuestion() {
        canClick = true;
        const stage = allStages[currentStage];
        const q = stage.data[quizIdx];
        
        document.getElementById('stage-name').innerText = stage.name;
        document.getElementById('question-num').innerText = `ç¬¬ ${quizIdx + 1} / 20 é¡Œ`;
        document.getElementById('display-word').innerText = q.w;
        document.getElementById('score-display').innerText = score;
        document.getElementById('feedback').innerText = "";
        
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";
        q.o.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.c);
            grid.appendChild(btn);
        });
    }

    function checkAnswer(btn, val, correct) {
        if (!canClick) return;
        const feedback = document.getElementById('feedback');
        
        if (val === correct) {
            canClick = false;
            btn.classList.add('correct');
            score += 10;
            document.getElementById('score-display').innerText = score;
            localStorage.setItem('mandarinScore', score);
            
            quizIdx++;
            if (quizIdx < 20) {
                setTimeout(loadQuestion, 600);
            } else {
                setTimeout(showStageComplete, 600);
            }
        } else {
            btn.classList.add('wrong');
            feedback.innerText = "å†è©¦ä¸€æ¬¡ï¼";
            feedback.style.color = "var(--accent)";
        }
    }

    function showStageComplete() {
        const content = document.getElementById('game-content');
        content.innerHTML = `
            <div style="padding: 20px;">
                <h2 style="color:var(--success);">ğŸ‰ æœ¬é—œé€šé—œï¼</h2>
                <p>ä½ å·²ç¶“å®Œæˆäº† "${allStages[currentStage].name}"</p>
                <p>ç›®å‰ç¸½ç©åˆ†ï¼š<strong>${score}</strong></p>
                <button class="nav-btn" onclick="startNextStage()">é€²å…¥ä¸‹ä¸€æ­¥</button>
            </div>
        `;
    }

    function startNextStage() {
        currentStage++;
        localStorage.setItem('mandarinStage', currentStage);
        // æ¢å¾©éŠæˆ²ç•Œé¢ HTML çµæ§‹
        document.getElementById('game-content').innerHTML = `
            <div class="info-bar">
                <span id="question-num"></span>
                <span>ç©åˆ†: <span id="score-display"></span></span>
            </div>
            <div id="stage-name" style="color: var(--main); font-weight: bold; margin-bottom: 10px;"></div>
            <div class="target-word" id="display-word"></div>
            <div class="options" id="options-grid"></div>
            <div id="feedback" style="margin-top: 15px; height: 20px; font-weight: bold;"></div>
        `;
        init();
    }

    function showFinalResult() {
        document.getElementById('game-content').innerHTML = `
            <div style="padding: 20px;">
                <h2 style="color:var(--main);">ğŸŠ æŒ‘æˆ°çµæŸï¼</h2>
                <p style="font-size: 20px;">æ­å–œä½ ï¼Œç²å¾—äº† <strong style="color:var(--accent); font-size: 32px;">${score}</strong> åˆ†ï¼</p>
                <p>ä½ å·²ç¶“å®Œå…¨æŒæ¡äº†æ™®é€šè©±è²æ¯çš„æ ¸å¿ƒè¾¨æã€‚</p>
                <button class="nav-btn" onclick="resetGame()">é‡æ–°é–‹å§‹æŒ‘æˆ°</button>
            </div>
        `;
        // ç¢ºä¿é€²åº¦æ¢å…¨éƒ¨äº®ç¶ ç‡ˆ
        for(let i=1; i<=5; i++) document.getElementById('s'+i).classList.add('done');
    }

    function resetGame() {
        localStorage.clear();
        location.reload();
    }

    init();
</script>
</body>
</html>
